# dataportal-availibility-updater


## Overview

The availability updater downloads all measure reports referenced by a document reference with the master
identifier `fdpg-availability-report` from a fhir server and based on a FDPG ontology extracts the information from the
reports about how often each criterion specified in the ontology is available, creates update json files for elastic
search and loads them into the specified elastic search instance.


## script variables - when executing the python script directly

| Name                                                  | Default                               | Description                                                                                           |
|:------------------------------------------------------|:--------------------------------------|:------------------------------------------------------------------------------------------------------|
| --onto-repo                                           | None                                  | The repository URL for the FHIR ontology generator.                                                   |
| --onto-git-tag                                        | None                                  | The Git tag or version of the FHIR ontology generator to be used.                                     |
| --update-ontology                                     | false                                 | Specifies whether the ontology should be updated (true/false).                                        |
| --ontology-dir                                        | None                                  | The directory where the ontology files are stored.                                                    |
| --availability-master-ident                           | None                                  | The ident of the DocumentReferences which should be imported.                                         |
| --availability-input-dir                              | None                                  | The directory for the input data used by the availability updater.                                    |
| --availability-output-dir                             | None                                  | The directory for the output data generated by the availability updater.                              |
| --availability-report-server-base-url                 | None                                  | The base URL of the availability report server.                                                       |
| --es-base-url                                         | None                                  | The base URL of the Elasticsearch instance.                                                           |
| --es-index                                            | None                                  | The Elasticsearch index used for storing ontology data.                                               |
| --min-n-reports                                       | 3                                     | The minimum number of reports required for the availability to be imported                            |
| --loglevel                                            | INFO                                  | The logging level for the application (e.g., DEBUG, INFO, WARNING, ERROR, CRITICAL). Default is INFO. |
| --use-oauth2                                          | disabled                              | Enable OAuth2 client-credentials authentication.                                                                                                                                             |
| --oauth-token-url                                     | None                                  | OAuth2 token endpoint URL. Required if `--use-oauth2` is set.                                                                                                                                |
| --oauth-client-id                                     | None                                  | OAuth2 client ID.                                                                                                                                                                            |
| --oauth-client-secret                                 | None                                  | OAuth2 client secret.                                                                                                                                                                        |
| --oauth-scope                                         | None                                  | Optional OAuth2 scope (space separated if multiple).                                                                                                                                         |
| --use-basic-auth                                      | disabled                              | Enable HTTP Basic Authentication.                                                                                                                                                            |
| --basic-username                                      | None                                  | Username for Basic Auth.                                                                                                                                                                     |
| --basic-password                                      | None                                  | Password for Basic Auth.                                                                                                                                                                     |
| --ca-cert                                             | None                                  | Path to a custom CA certificate file (e.g., self-signed). If not provided, system trust store is used. When provided, it is added to the default trust chain (system CAs are still trusted). |



## Environment variables - when using container image

| Name                                | Default                                                                                                                                                                                | Description                                                                         |
| :---------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :---------------------------------------------------------------------------------- |
| ONTO_REPO                           | [https://github.com/medizininformatik-initiative/fhir-ontology-generator/releases/download](https://github.com/medizininformatik-initiative/fhir-ontology-generator/releases/download) | The repository URL for the FHIR ontology generator.                                 |
| ONTO_GIT_TAG                        | v3.0.2-alpha                                                                                                                                                                           | The Git tag of the FHIR ontology.                                                   |
| ONTOLOGY_DIR                        | /opt/availability-updater/elastic_ontology                                                                                                                                             | The directory where the ontology files are stored inside container - leave default. |
| UPDATE_ONTOLOGY                     | true                                                                                                                                                                                   | Specifies whether the ontology should be updated (true/false).                      |
| AVAILABILITY_MASTER_IDENT           | fdpg-data-availability-report-obfuscated                                                                                                                                               | The ident of the DocumentReferences which should be imported.                       |
| AVAILABILITY_INPUT_DIR              | /opt/availability-updater/availability_input                                                                                                                                           | Input directory inside container - leave default.                                   |
| AVAILABILITY_OUTPUT_DIR             | /opt/availability-updater/availability_output                                                                                                                                          | Output directory inside container - leave default.                                  |
| AVAILABILITY_REPORT_SERVER_BASE_URL | [http://availability-report-store:8080/fhir](http://availability-report-store:8080/fhir)                                                                                               | Base URL of the availability report server.                                         |
| ES_BASE_URL                         | [http://availability-dataportal-elastic:9200](http://availability-dataportal-elastic:9200)                                                                                             | The base URL of the Elasticsearch instance.                                         |
| ES_INDEX                            | ontology                                                                                                                                                                               | The Elasticsearch index used for storing ontology data.                             |
| MIN_N_REPORTS                       | 3                                                                                                                                                                                      | The minimum number of reports required for import.                                  |
| LOGLEVEL                            | INFO                                                                                                                                                                                   | Logging level (e.g., INFO, DEBUG, ERROR).                                           |
| USE_OAUTH2                          | false                                                                                                       | Enable OAuth2 authentication (client-credentials flow).                                                                                                        |
| OAUTH_TOKEN_URL                     | ""                                                                                                          | OAuth2 token endpoint URL.                                                                                                                                     |
| OAUTH_CLIENT_ID                     | ""                                                                                                          | OAuth2 client ID.                                                                                                                                              |
| OAUTH_CLIENT_SECRET                 | ""                                                                                                          | OAuth2 client secret.                                                                                                                                          |
| OAUTH_SCOPE                         | ""                                                                                                          | Optional OAuth2 scope.                                                                                                                                         |
| USE_BASIC_AUTH                      | false                                                                                                       | Enable HTTP Basic Authentication.                                                                                                                              |
| BASIC_USERNAME                      | ""                                                                                                          | Username for Basic Auth.                                                                                                                                       |
| BASIC_PASSWORD                      | ""                                                                                                          | Password for Basic Auth.                                                                                                                                       |
| CA_CERT                             | ""                                                                                                          | Path to additional CA certificate mounted into the container. If set, it is merged with the system trust store to allow self-signed/internal PKI certificates. |
