# dataportal-availibility-updater


## Overview

The availability updater downloads all measure reports referenced by a document reference with the master
identifier `fdpg-availability-report` from a fhir server and based on a FDPG ontology extracts the information from the
reports about how often each criterion specified in the ontology is available, creates update json files for elastic
search and loads them into the specified elastic search instance.


## script variables - when executing the python script directly

| Name                                                  | Default                               | Description                                                                                           |
|:------------------------------------------------------|:--------------------------------------|:------------------------------------------------------------------------------------------------------|
| --onto_repo                                           | None                                  | The repository URL for the FHIR ontology generator.                                                   |
| --onto_git_tag                                        | None                                  | The Git tag or version of the FHIR ontology generator to be used.                                     |
| --update_ontology                                     | false                                 | Specifies whether the ontology should be updated (true/false).                                        |
| --ontology_dir                                        | None                                  | The directory where the ontology files are stored.                                                    |
| --availability_master_ident                           | None                                  | The ident of the DocumentReferences which should be imported.                                         |
| --availability_input_dir                              | None                                  | The directory for the input data used by the availability updater.                                    |
| --availability_output_dir                             | None                                  | The directory for the output data generated by the availability updater.                              |
| --availability_report_server_base_url                 | None                                  | The base URL of the availability report server.                                                       |
| --es_base_url                                         | None                                  | The base URL of the Elasticsearch instance.                                                           |
| --es_index                                            | None                                  | The Elasticsearch index used for storing ontology data.                                               |
| --loglevel                                            | INFO                                  | The logging level for the application (e.g., DEBUG, INFO, WARNING, ERROR, CRITICAL). Default is INFO. |



## Environment variables - when using container image

| Name                                     | Default                                                                                   | Description                                                                                               |
|:-----------------------------------------|:------------------------------------------------------------------------------------------|:----------------------------------------------------------------------------------------------------------|
| ONTO_REPO                                | https://github.com/medizininformatik-initiative/fhir-ontology-generator/releases/download | The repository URL for the FHIR ontology generator.                                                       |
| ONTO_GIT_TAG                             | v3.0.2-alpha                                                                              | The Git tag of the FHIR ontology                                                                          |
| ONTOLOGY_DIR                             | /opt/availability-updater/elastic_ontology                                                | The directory where the ontology files are stored inside container - leave default                        |
| UPDATE_ONTOLOGY                          | true                                                                                      | Specifies whether the ontology should be updated (true/false)                                             |
| AVAILABILITY_MASTER_IDENT                | fdpg-data-availability-report-obfuscated                                                  | The ident of the DocumentReferences which should be imported.                                            |
| AVAILABILITY_INPUT_DIR                   | /opt/availability-updater/availability_input                                              | The directory for the input data used by the availability updater  inside container - leave default       |
| AVAILABILITY_OUTPUT_DIR                  | /opt/availability-updater/availability_output                                             | The directory for the output data generated by the availability updater  inside container - leave default |
| AVAILABILITY_REPORT_SERVER_BASE_URL      | http://availability-report-store:8080/fhir                                                | The base URL of the availability report server - local fhir server which contains the reports             |
| ES_BASE_URL                              | http://availability-dataportal-elastic:9200                                               | The base URL of the Elasticsearch instance.                                                               |
| ES_INDEX                                 | ontology                                                                                  | The Elasticsearch index used for storing ontology data.                                                   |
| LOGLEVEL                                 | INFO                                                                                      | The logging level for the application (e.g., INFO, DEBUG, ERROR).                                         |
